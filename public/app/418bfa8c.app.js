"use strict";var angular=angular;angular.module("edumaterialApp",["ngCookies","ngResource","ngSanitize","btford.socket-io","ui.router","ui.bootstrap","angular-loading-bar","ui.utils","ui.select","uuid4"]).config(["$stateProvider","$urlRouterProvider","$locationProvider","$httpProvider",function(a,b,c,d){b.otherwise("/"),c.html5Mode(!0),d.interceptors.push("authInterceptor")}]).config(["cfpLoadingBarProvider",function(a){a.latencyThreshold=500}]).config(["$provide",function(a){a.decorator("$state",["$delegate","$stateParams",function(a,b){return a.forceReload=function(){return a.go(a.current,b,{reload:!0,inherit:!1,notify:!0})},a}])}]).factory("authInterceptor",["$rootScope","$q","$cookieStore","$location",function(a,b,c,d){return{request:function(a){return a.headers=a.headers||{},c.get("token")&&(a.headers.Authorization="Bearer "+c.get("token")),a},responseError:function(a){return 401===a.status?(d.path("/login"),c.remove("token"),b.reject(a)):b.reject(a)}}}]).run(["$rootScope","$location","Auth",function(a,b,c){a.$on("$stateChangeStart",function(a,d){c.isLoggedInAsync(function(a){d.authenticate&&!a&&b.path("/login")})})}]),angular.module("edumaterialApp").config(["$stateProvider",function(a){a.state("login",{url:"/login",templateUrl:"app/account/login/login.html",controller:"LoginCtrl"}).state("signup",{url:"/signup",templateUrl:"app/account/signup/signup.html",controller:"SignupCtrl"}).state("settings",{url:"/settings",templateUrl:"app/account/settings/settings.html",controller:"SettingsCtrl",authenticate:!0})}]),angular.module("edumaterialApp").controller("LoginCtrl",["$scope","Auth","$location","$window",function(a,b,c,d){a.user={},a.errors={},a.login=function(d){a.submitted=!0,d.$valid&&b.login({email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){a.errors.other=b.message})},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("edumaterialApp").controller("SettingsCtrl",["$scope","User","Auth",function(a,b,c){a.errors={},a.changePassword=function(b){a.submitted=!0,b.$valid&&c.changePassword(a.user.oldPassword,a.user.newPassword).then(function(){a.message="Password successfully changed."})["catch"](function(){b.password.$setValidity("mongoose",!1),a.errors.other="Incorrect password",a.message=""})}}]),angular.module("edumaterialApp").controller("SignupCtrl",["$scope","Auth","$location","$window",function(a,b,c,d){a.user={},a.errors={},a.register=function(d){a.submitted=!0,d.$valid&&b.createUser({name:a.user.name,email:a.user.email,password:a.user.password}).then(function(){c.path("/")})["catch"](function(b){b=b.data,a.errors={},angular.forEach(b.errors,function(b,c){d[c].$setValidity("mongoose",!1),a.errors[c]=b.message})})},a.registerOauth=function(){d.location.href="https://carre.kmi.open.ac.uk/devices/accounts/register?next=http://edu.carre-project.eu"},a.loginOauth=function(a){d.location.href="/auth/"+a}}]),angular.module("edumaterialApp").controller("AdminCtrl",["$scope","$http","Auth","User",function(a,b,c,d){a.users=d.query(),a["delete"]=function(b){d.remove({id:b._id}),angular.forEach(a.users,function(c,d){c===b&&a.users.splice(d,1)})}}]),angular.module("edumaterialApp").config(["$stateProvider",function(a){a.state("admin",{url:"/admin",templateUrl:"app/admin/admin.html",controller:"AdminCtrl"})}]),angular.module("edumaterialApp").service("article",["rdf","uuid4","enrichment","rank","Auth",function(a,b,c,d,e){function f(){a.find([["?s",a.pre.edu+"#title","?title"],["?rating",a.pre.edu+"#for_article","?s"],["?rating",a.pre.edu+"#rated_by_user",n.carre.graph]],["?title ?rating"],["LIMIT 1000"]).success(function(a){l=a.data,console.log(l)})}function g(b){console.log("Rated articles fetching");for(var c="SELECT ?title (AVG(?ratingval) as ?ratingavg) WHERE {",d=0;d<b.length;d++)b[d].url=b[d].url||"http://en.wikipedia.org/wiki/"+encodeURI(b[d].title).split("%20").join("_"),c+="{ ?s <"+a.pre.edu+"#url> <"+b[d].url+"> }",d<b.length-1&&(c+=" UNION ");return c+=" .?s <"+a.pre.edu+"#title> ?title . ?rating <"+a.pre.rdftype+"> <"+a.pre.edu+"#rating> . ?rating <"+a.pre.edu+"#for_article> ?s . ?rating ?any ?ratingval . FILTER (datatype(?ratingval) = xsd:integer) } GROUP BY ?title LIMIT 20",a.query(c).success(function(a){return console.log("Rated Articles are:"),k=a.data,a.data}).error(function(a){console.log(a)})}function h(c){return m=c,a.find([["?id",a.pre.edu+"#url",c.url],["?id",a.pre.edu+"#views","?views"]],["?id ?views"],["LIMIT 1"]).success(function(a){console.log(a.data),a.data.length>0?(c.id=a.data[0].id.value.substring(47),c.views=Number(a.data[0].views.value),i({id:c.id,views:c.views,url:c.url,riskElement:c.riskElement})):(c.id=b.generate(),c.views=1,j(c)),m.id=c.id}).error(function(a){return console.log(a),!1})}function i(b){var c=[],d=[];c.push([a.pre.publicUri+b.id,a.pre.edu+"#views",'"'+b.views+'"^^xsd:nonNegativeInteger']),d.push([a.pre.publicUri+b.id,a.pre.edu+"#views",'"'+(b.views+1)+'"^^xsd:nonNegativeInteger']),a.modify(c,c,d).success(function(a){console.log(d),console.log(a)}).error(function(a){console.log("Error :"),console.log(a)})}function j(b){var c=[];c.push([a.pre.publicUri+b.id,a.pre.rdftype,a.pre.edu+"#object"]),c.push([a.pre.publicUri+b.id,a.pre.edu+"#url",b.url]),c.push([a.pre.publicUri+b.id,a.pre.edu+"#views",'"'+b.views+'"^^xsd:nonNegativeInteger']),b.date&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#date_accepted",'"'+b.date+'"^^xsd:date']),b.title&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#title",'"'+b.title+'"^^xsd:string']),b.snippet&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#snippet",'"'+b.snippet+'"^^xsd:string']),b.lang&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#language",'"'+b.lang+'"^^xsd:string']),b.wordcount&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#wordcount",'"'+b.wordcount+'"^^xsd:nonNegativeInteger']),b.categories&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#categories",'"'+b.categories+'"^^xsd:string']),b.source&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#source",'"'+b.source+'"^^xsd:string']),b.websource&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#websource",'"'+b.websource+'"^^xsd:string']),b.altTitle&&c.push([a.pre.publicUri+b.id,a.pre.edu+"#alternative_title",'"'+b.altTitle+'"^^xsd:string']),a.insert(c).success(function(a){console.log(c),console.log(a)}).error(function(a){console.log("Error :"),console.log(a)})}var k=[],l=[],m={},n=e.getCurrentUser()||{carre:{graph:a.pre.users+"guestuser"}};return{getUserRated:f,getRated:g,userRated:function(){return l},rated:function(){return k},insert:h,getCurrent:function(){return m}}}]),angular.module("edumaterialApp").controller("BioportalCtrl",["$rootScope","$http","$scope","bioportal","Auth",function(a,b,c,d,e){c.ontologies=[],c.ontology={},c.showSelector=!1,c.results={},c.results.page=1,c.selectedAcronyms=function(){for(var a=c.ontology.selected,b="",d=0;d<a.length;d++)b+=a[d].acronym+(a.length-1===d?"":",");return b},d.ontologies().success(function(a){c.ontologies=a}),c.searchTerm=function(){var a=c.ontology.selected?c.selectedAcronyms():"";d.search(c.results.page,c.queryTerm,a).then(function(a){c.results=a.data,c.results.collection.length<10&&c.results.page>1?c.total=10*c.results.pageCount:c.total=c.results.collection.length*c.results.pageCount||0,console.log(c.results)})},e.searchQuery&&(c.queryTerm=e.searchQuery,c.searchTerm())}]),angular.module("edumaterialApp").config(["$stateProvider",function(a){a.state("bioportal",{url:"/bioportal",templateUrl:"app/bioportal/bioportal.html",controller:"BioportalCtrl"})}]),angular.module("edumaterialApp").factory("bioportal",["$http",function(a){function b(b,c,e,f){var g=!1,h=!1,i=!0,j=!0,k=!1,l=!1,m=f||null,n="prefLabel,synonym,definition,cui",o=d.apiurl+"/search?q="+c+"&ontologies="+e+(m?"&cui="+m:"")+"&apikey="+d.apikey+"&format="+d.format+"&include_views="+d.include_views+"&include_context="+d.include_context+"&include_links="+d.include_links+"&download_format="+d.download_format+"&pagesize="+d.pagesize+"&include="+n+"&page="+b+"&exact_match="+g+"&suggest="+h+"&also_search_views="+i+"&require_definition="+j+"&include_obsolete="+l+"&include_properties="+k;return a.get(o,{cache:!0})}function c(){var b=d.apiurl+"/ontologies/?apikey="+d.apikey+"&format="+d.format+"&include_views=false&include_context=false&include_links=false&include=name,acronym";return a.get(b,{cache:!0})}var d={apiurl:"http://data.bioontology.org",apikey:"a15281a9-d87d-4c0f-b7aa-31debe0f6449",include:"",format:"json",page:null,pagesize:10,include_views:!0,include_context:!1,include_links:!0,download_format:null};return{search:b,ontologies:c}}]),angular.module("edumaterialApp").controller("DbpediaCtrl",["$http","$scope","Auth",function(a,b,c){function d(){b.total=0,b.results=[],b.filteredResults=[]}b.itemsPerPage=10,b.currentPage=1,d(),b.searchTerm=function(){d(),a.get("/api/dbpedia/term/"+encodeURI(b.queryTerm)+"/en",{cache:!0}).then(function(a){b.results=a.data,b.total=b.results.length,b.pageCount=Math.ceil(b.total/b.itemsPerPage),b.total>0?b.$watch("currentPage + itemsPerPage",function(){var a=(b.currentPage-1)*b.itemsPerPage,c=a+b.itemsPerPage;b.filteredResults=b.results.slice(a,c)}):b.filteredResults=[]})},c.searchQuery&&(b.queryTerm=c.searchQuery,b.searchTerm())}]),angular.module("edumaterialApp").config(["$stateProvider",function(a){a.state("dbpedia",{url:"/dbpedia",templateUrl:"app/dbpedia/dbpedia.html",controller:"DbpediaCtrl"})}]),angular.module("edumaterialApp").service("enrichment",function(){}),String.prototype.distance=function(a){var b;b=this;var c,d,e,f,g,h,i,j,k,l,m;for(b.length>a.length&&(a=[a,b],b=a[0],a=a[1]),f=~~Math.max(0,a.length/2-1),g=[],h=[],d=k=0,m=b.length;m>k;d=++k)for(c=b[d],j=Math.max(0,d-f),i=Math.min(d+f+1,a.length),e=l=j;i>=j?i>l:l>i;e=i>=j?++l:--l)if(null==h[e]&&c===a[e]){g[d]=c,h[e]=a[e];break}if(g=g.join(""),h=h.join(""),e=g.length){for(d=i=f=0,j=g.length;j>i;d=++i)c=g[d],c!==h[d]&&f++;for(d=h=g=0,i=b.length;i>h&&(c=b[d],c===a[d]);d=++h)g++;b=(e/b.length+e/a.length+(e-~~(f/2))/e)/3,b+=.1*Math.min(g,4)*(1-b)}else b=0;return b},angular.module("edumaterialApp").service("jaroWinkler",function(){return!0}),angular.module("edumaterialApp").controller("MainCtrl",["$scope","$http","Auth","$location","suggest","$sce","main","$timeout","medlineplus","$window","article","rating",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){a.total=0,a.results=[],c.searchQuery&&(a.queryTerm=c.searchQuery,a.searchQuery())}function n(a){return String(a).replace(/<[^>]+>/gm,"")}a.isLoggedIn=c.isLoggedIn,a.user=c.user=c.getCurrentUser();var o=!1;a.riskElements=[],e.riskelements().then(function(b){a.riskElements=b}),a.docSources=[{label:"MedlinePLUS",value:"medlineplus"},{label:"Wikipedia",value:"wikipedia"}],a.curSource=a.docSources[1],a.itemsPerPage=20,a.currentPage=1,a.rating=[{rdftype:"depth_of_coverage",name:"Depth of Coverage",value:0},{rdftype:"comprehensiveness",name:"Comprehensiveness",value:0},{rdftype:"relevancy",name:"Relevancy",value:0},{rdftype:"accuracy",name:"Accuracy",value:0},{rdftype:"educational_level",name:"Educational level",value:0},{rdftype:"validity",name:"Validity",value:0}],c.rating_criteria=a.rating,a.getSuggestions=function(a){return e["for"](a)},a.onComplete=function(b,c,d){b&&(a.riskElement=b),a.searchQuery()},a.toggleArticle=function(b){b>-1?(a.showArticle=!0,a.frameHeight=j.innerHeight-50,a.mobile=j.innerWidth<700?!0:!1,a.doc=a.results[b],a.doc.pos=b,a.doc.rating=a.doc.rating||[],a.doc.iframe="",a.doc.riskElement=a.riskElement?a.riskElement.url:"",h(function(){a.doc.iframe=q(),document.querySelector("body").style.overflowY=a.showArticle?"hidden":"visible"},900)):(a.isLoggedIn()&&g.setRating(a.doc.rating).then(function(a){t()}),a.isCollapsed=!1,a.doc={},a.doc.iframe="",a.showArticle=!1,h(function(){document.querySelector("body").style.overflowY=a.showArticle?"hidden":"visible"},100))};var p=function(){g.setArticle({title:n(a.doc.title),snippet:n(a.doc.FullSummary||a.doc.snippet),date:(new Date).toISOString(),url:a.doc.url,websource:a.curSource.value,source:n(a.doc.organizationName||""),mesh:n(a.doc.mesh||""),lang:"English",altTitle:n(a.doc.altTitle||""),categories:n(a.doc.groupName||""),wordcount:a.doc.wordcount||"",riskElement:a.doc.riskElement}),console.log(a.doc.riskElement),g.setRank({position:a.doc.pos,total:a.total,date:(new Date).toISOString(),query:a.queryTerm,article_risk:a.doc.riskElement}),a.isLoggedIn()&&l.load({url:a.doc.url}).then(function(b){var c=b.data.data[0];console.log("Rating Object is "),console.log(c),a.doc.rating=[];for(var d=0;6>d;d++)a.doc.rating[d]={value:0};c&&(a.doc.rating[0].value=c.depth_of_coverage.value||0,a.doc.rating[1].value=c.comprehensiveness.value||0,a.doc.rating[2].value=c.relevancy.value||0,a.doc.rating[3].value=c.accuracy.value||0,a.doc.rating[4].value=c.educational_level.value||0,a.doc.rating[5].value=c.validity.value||0)}),g.editArticle()},q=function(){var b="";switch(a.doc.title=n(a.doc.title),a.curSource.value){case"medlineplus":b=a.mobile?'<div style="background:#ffffff;height:'+a.frameHeight+'px; overflow-y:auto;"><h2>'+a.doc.title+"</h2><p>"+a.doc.FullSummary+"</p></div>":'<base target="_blank" /><iframe style="width:100%;height:'+a.frameHeight+'px;" class="embed-responsive-item" src="'+a.doc.url.replace("http://","https://")+'"sandbox="allow-same-origin"></iframe>';break;case"wikipedia":a.doc.url="http://en.wikipedia.org/wiki/"+encodeURI(a.doc.title).split("%20").join("_"),b='<base target="_blank" /><iframe style="width:100%;height:'+a.frameHeight+'px;" class="embed-responsive-item" src="'+a.doc.url.replace("http://","https://")+(a.mobile?"?printable=yes":"")+'"></iframe>'}return p(),f.trustAsHtml(b)};a.searchQuery=function(){if(void 0!=a.queryTerm&&""!==a.queryTerm)switch(c.searchQuery=a.queryTerm,c.notifyNavbar(),a.curSource.value){case"medlineplus":r();break;case"wikipedia":s();break;default:console.log("no source selected")}};var r=function(){i.search((a.currentPage-1)*a.itemsPerPage,a.queryTerm).then(function(b){b.data.message?(a.total=0,a.results=[]):(a.results=b.data.list,a.total=Number(b.data.count[0]),a.pageCount=Math.ceil(a.total/a.itemsPerPage),a.total>a.itemsPerPage&&a.results.retstart&&(a.currentPage=Math.ceil(a.results.retstart[0]/a.itemsPerPage)+1),t())})},s=function(){b.get("/api/wikipedia/search/"+encodeURI(a.queryTerm)+"/"+(a.currentPage-1)*a.itemsPerPage,{cache:!0}).then(function(b){b.data.search.length>0?(a.results=b.data.search,a.total=b.data.searchinfo.totalhits,a.pageCount=Math.ceil(a.total/a.itemsPerPage),a.suggestion=b.data.searchinfo.suggestion,t()):(a.total=0,a.results=[])})};m();var t=function(){k.getRated(a.results).then(function(b){for(var c=0,d=b.data.data;c<d.length;c++)for(var e=0;e<a.results.length;e++)n(a.results[e].title).trim()===d[c].title.value.trim()&&(a.results[e].avgRating=d[c].ratingavg.value);console.log("started test func"),o&&a.start()})};a.start=function(){var b=a.results.length>20?20:a.results.length,c=function(){console.log("At "+b),a.toggleArticle(b-1),h(function(){a.toggleArticle(-1)},4e3),b-=1,b>=0&&(h(c,5e3),console.log("At "+b))};c()}}]),angular.module("edumaterialApp").config(["$stateProvider",function(a){a.state("main",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}).state("main.preview",{url:"/article/{doc.title}",templateUrl:"app/main/article_view.html"})}]),angular.module("edumaterialApp").service("main",["$q","article","rdf","rank","rating","enrichment",function(a,b,c,d,e,f){function g(){console.log("editArticle called!"),a.all([b.insert(j).then(function(){return j.id=b.getCurrent().id,k.article_id=j.id,k.article_risk=b.getCurrent().riskElement,d.insert(k)},function(a){console.log(a)})]).then(function(a){console.log(a[0].data.data[0])})}function h(){console.log("fetchArticles called!"),a.all([b.insert(j).then(function(){return j.id=b.getCurrent().id,k.article_id=j.id,k.article_risk=b.getCurrent().riskElement,d.insert(k)},function(a){console.log(a)})]).then(function(a){console.log(a[0].data.data)})}function i(){var a="PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#> PREFIX edu: <http://carre.kmi.open.ac.uk/ontology/educational.owl#> PREFIX rdftype: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> PREFIX dc: <http://purl.org/dc/elements/1.1/> PREFIX users: <https://carre.kmi.open.ac.uk/users/> SELECT ?title ?url ?views (count(?rating) as ?ratings) WHERE { ?s rdf:type edu:object. ?s edu:title ?title. ?s edu:url ?url. ?s edu:views ?views. ?rating rdf:type edu:rating. ?rating edu:for_article ?s. } ";return c.query(a).success(function(a){console.log("Example Query : "),console.log(a)}).error(function(a){console.log(a)})}var j={},k={};return{setArticle:function(a){j=a},article:function(){return j},setRank:function(a){k=a},rank:function(){return k},setRating:function(a){return j.rating=a,e.insert(j)},rating:function(){return j.rating},editArticle:g,fetchArticles:h,exampleQuery:i}}]),angular.module("edumaterialApp").controller("MedlineplusCtrl",["$http","$scope","medlineplus","Auth",function(a,b,c,d){b.results={},b.totalPagination=0,b.curPagePagination=1,b.pageCountPagination=0,b.maxPerPage=10,b.maxPagination=4,b.rotatePagination=!1,b.searchTerm=function(){c.search((b.curPagePagination-1)*b.maxPerPage,b.medlineTerm).then(function(a){b.results=a.data,b.totalPagination=Number(b.results.count[0]),b.pageCountPagination=Math.ceil(b.totalPagination/b.maxPerPage),b.curPagePagination=Math.ceil(b.results.retstart[0]/b.maxPerPage)+1})},d.searchQuery&&(b.medlineTerm=d.searchQuery,b.searchTerm()),b.max=5}]),angular.module("edumaterialApp").config(["$stateProvider",function(a){a.state("medlineplus",{url:"/medlineplus",templateUrl:"app/medlineplus/medlineplus.html",controller:"MedlineplusCtrl"})}]),angular.module("edumaterialApp").factory("medlineplus",["$http",function(a){function b(b,d){var e=c.apiurl+"term="+encodeURI(d)+"&retstart="+(b||0)+"&db="+c.db+"&rettype="+c.rettype+"&retmax="+c.retmax+"&tool="+c.tool+"&email="+c.email;return a.get(e,{cache:!0})}var c={apiurl:"/api/medlineplus/query/",db:"healthTopics",rettype:"brief",retmax:20,tool:"carre-project-educational-aggregator",email:"portokallidis@gmail.com"};return{search:b}}]),angular.module("edumaterialApp").service("rank",["rdf","uuid4",function(a,b){function c(c){return a.find([["?id",a.pre.rdftype,a.pre.edu+"#rank"],["?id",a.pre.edu+"#for_article",a.pre.publicUri+c.article_id],["?id",a.pre.edu+"#query",'"'+c.query+'"^^xsd:string']],["?id"],["LIMIT 1"]).success(function(a){return a.data.length>0?(c.id=a.data[0].id.value.substring(52),d(c)):(c.id=b.generate(),e(c)),f(c),c.id}).error(function(a){return console.log(a),!1})}function d(b){console.log("Modify Rank called!");var c=[],d=[];c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#date","?date"]),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#total","?total"]),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#total","?pos"]),d.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#date",'"'+b.date+'"^^xsd:date']),d.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#total",'"'+b.total+'"^^xsd:nonNegativeInteger']),d.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#total",'"'+b.position+'"^^xsd:nonNegativeInteger']),a.modify(c,c,d).success(function(a){console.log(a)}).error(function(a){console.log("Error :"),console.log(a)})}function e(b){console.log("Insert Rank called!");var c=[];c.push([a.pre.publicUri+"rank/"+b.id,a.pre.rdftype,a.pre.edu+"#rank"]),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#for_article",a.pre.publicUri+b.article_id]),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#query",'"'+b.query+'"^^xsd:string']),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#date",'"'+b.date+'"^^xsd:date']),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#total",'"'+b.total+'"^^xsd:nonNegativeInteger']),c.push([a.pre.publicUri+"rank/"+b.id,a.pre.edu+"#position",'"'+b.position+'"^^xsd:nonNegativeInteger']),a.insert(c).success(function(a){console.log(a)}).error(function(a){console.log("Error :"),console.log(a)})}function f(b){console.log("Insert Risk Element called!");var c=[];b.article_risk&&c.push([b.article_risk,"http://carre.kmi.open.ac.uk/ontology/risk.owl#has_educational_material",a.pre.publicUri+b.article_id]),a.insert(c).success(function(a){console.log(a)}).error(function(a){console.log("Error :"),console.log(a)})}return{insert:c}}]),angular.module("edumaterialApp").service("rating",["rdf","uuid4","Auth",function(a,b,c){function d(c){var d=c.rating.reduce(function(a,b){return a+Number(b.value)},0);return console.log("Rating Sum is : "+d),a.find([["?id",a.pre.rdftype,a.pre.edu+"#rating"],["?id",a.pre.edu+"#for_article",a.pre.publicUri+c.id],["?id",a.pre.edu+"#rated_by_user",h.carre.graph]],["?id"],["LIMIT 1"]).success(function(a){var e={};return e.article_id=c.id,e.rates=c.rating,e.date=(new Date).toISOString(),0===d?!1:a.data[0]&&a.data[0].id?(e.id=a.data[0].id.value.substring(54),console.log(e.id),f(e)):(e.id=b.generate(),g(e))}).error(function(a){return console.log(a),!1})}function e(b){return console.log("Load Rating Called for article: "+b.url+" by user "+h.carre.graph),a.find([["?id",a.pre.rdftype,a.pre.edu+"#rating"],["?article",a.pre.edu+"#url",b.url],["?id",a.pre.edu+"#for_article","?article"],["?id",a.pre.edu+"#rated_by_user",h.carre.graph],["?id",a.pre.edu+"#depth_of_coverage","?depth_of_coverage"],["?id",a.pre.edu+"#comprehensiveness","?comprehensiveness"],["?id",a.pre.edu+"#relevancy","?relevancy"],["?id",a.pre.edu+"#accuracy","?accuracy"],["?id",a.pre.edu+"#educational_level","?educational_level"],["?id",a.pre.edu+"#validity","?validity"]],["?depth_of_coverage ?comprehensiveness ?relevancy ?accuracy ?educational_level ?validity"])}function f(b){console.log("Modify Rating called!"),console.log(b);var d=[],e=[];d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#date","?date"]);for(var f=0,g=c.rating_criteria;f<g.length;f++)b.rates[f]||(b.rates[f]={value:0}),d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#"+g[f].name.replace(/\s+/g,"_").toLowerCase(),"?ra"+f]);console.log(d),e.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#date",'"'+b.date+'"^^xsd:date']);for(var f=0,g=c.rating_criteria;f<g.length;f++)b.rates[f]||(b.rates[f]={value:0}),e.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#"+g[f].name.replace(/\s+/g,"_").toLowerCase(),'"'+b.rates[f].value+'"^^xsd:nonNegativeInteger']);return console.log(e),a.modify(d,d,e).success(function(a){console.log(a)}).error(function(a){console.log("Error :"),console.log(a)})}function g(b){console.log("Insert Rating called!");var d=[];d.push([a.pre.publicUri+"rating/"+b.id,a.pre.rdftype,a.pre.edu+"#rating"]),d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#for_article",a.pre.publicUri+b.article_id]),d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#rated_by_user",h.carre.graph]),d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#date",'"'+b.date+'"^^xsd:date']);for(var e=0,f=c.rating_criteria;e<f.length;e++)b.rates[e]||(b.rates[e]={value:0}),d.push([a.pre.publicUri+"rating/"+b.id,a.pre.edu+"#"+f[e].name.replace(/\s+/g,"_").toLowerCase(),'"'+b.rates[e].value+'"^^xsd:nonNegativeInteger']);return a.insert(d).success(function(a){console.log(a)}).error(function(a){console.log("Error :"),console.log(a)})}var h=c.getCurrentUser()||{carre:{graph:a.pre.users+"guestuser"}};return{insert:d,load:e}}]),angular.module("edumaterialApp").service("rdf",["$http",function(a){function b(a,b,c,d,e,f){return a&&a.indexOf("http")>=0&&!d&&(a="<"+a+">"),b&&b.indexOf("http")>=0&&!e&&(b="<"+b+">"),c&&c.indexOf("http")>=0&&!f&&(c="<"+c+">"),a+" "+b+" "+c}function c(a){return a.map(function(a){return b(a[0],a[1],a[2])}).join(".")}function d(b){return a.post("/api/resources/query",{sparql:b},{cache:!0,ignoreLoadingBar:!0})}function e(a,b,e){return b||(b=["*"]),a||(a=["?s ?p ?o"]),e||(e=["LIMIT 20"]),d("SELECT "+b.join(" ")+" FROM <http://carre.kmi.open.ac.uk/public> WHERE { "+c(a)+"} "+e.join(" "))}function f(a,b,e){return a||(a=[]),e||(e=[]),b||(b=[]),d("MODIFY <http://carre.kmi.open.ac.uk/public> DELETE { "+c(b)+" } INSERT { "+c(e)+" } WHERE { "+c(a)+"} ")}function g(a){return!a||a.length<1?{error:"You have not specified any triples"}:d("INSERT DATA { GRAPH <http://carre.kmi.open.ac.uk/public> { "+c(a)+"}}")}var h={edu:"http://carre.kmi.open.ac.uk/ontology/educational.owl",rdftype:"http://www.w3.org/1999/02/22-rdf-syntax-ns#type",dc:"http://purl.org/dc/elements/1.1/",publicUri:"http://carre.kmi.open.ac.uk/public/educational/",users:"https://carre.kmi.open.ac.uk/users/"};return{query:d,find:e,insert:g,modify:f,pre:h}}]),angular.module("edumaterialApp").factory("suggest",["$http",function(a){var b=function(b){return b.length>2?a.get("/api/wikipedia/autocomplete/"+encodeURI(b),{cache:!0,ignoreLoadingBar:!0}).then(function(a){return a.data.length>1?a.data:[]}):[]},c=function(){return a.get("/api/riskelements",{cache:!0,ignoreLoadingBar:!0}).then(function(a){return a.data.length>1?a.data:[]})};return{"for":b,riskelements:c}}]),angular.module("edumaterialApp").controller("WikipediaCtrl",["$scope","$http","Auth","suggest","$location","$sce","$timeout",function(a,b,c,d,e,f,g){function h(){a.total=0,a.results=[],c.searchQuery&&(a.queryTerm=c.searchQuery,a.searchTerm())}a.itemsPerPage=20,a.currentPage=1,a.rating=[{name:"Depth of Coverage",value:0},{name:"Comprehensiveness",value:0},{name:"Relevancy",value:0},{name:"Accuracy",value:0},{name:"Educational level",value:0},{name:"Validity",value:0}],a.suggest=function(b){a.queryTerm=b,a.searchTerm()},a.getSuggestions=function(a){return d["for"](a)},a.onComplete=function(b){b&&(a.queryTerm=b,a.searchTerm())},a.toggleArticle=function(c){if(c>-1){a.showArticle=!0,a.doc=a.results[c],a.doc.iframe="",a.doc.rating=a.doc.rating||[];var d=a.doc.title;g(function(){a.doc.iframe=i("http://en.wikipedia.org/wiki/"+encodeURI(d).split("%20").join("_"),!0),document.querySelector("body").style.overflowY=a.showArticle?"hidden":"visible"},900),b.get("/api/wikipedia/article/"+encodeURI(d),{cache:!0}).then(function(b){a.doc.fetched=b.data.text["*"]}).then(function(){})}else a.isCollapsed=!1,a.doc={},a.doc.iframe=i("",!1),a.showArticle=!1,g(function(){document.querySelector("body").style.overflowY=a.showArticle?"hidden":"visible"},100)},a.articleInfo="ICD-10 : 230444",a.articleRating="Information Quality";var i=function(a,b){var c="";return b&&(a.search("medlineplus")>0&&(c='sandbox="allow-same-origin"'),a='<iframe style="width:100%;" class="embed-responsive-item" src="'+a+'"'+c+"></iframe>"),f.trustAsHtml(a)};a.searchTerm=function(c){c||(a.currentPage=1),b.get("/api/wikipedia/search/"+encodeURI(a.queryTerm)+"/"+(a.currentPage-1)*a.itemsPerPage,{cache:!0}).then(function(b){a.results=b.data.search,a.total=b.data.searchinfo.totalhits,a.pageCount=Math.ceil(a.total/a.itemsPerPage),a.suggestion=b.data.searchinfo.suggestion})},h()}]),angular.module("edumaterialApp").config(["$stateProvider",function(a){a.state("wikipedia",{url:"/wikipedia",templateUrl:"app/wikipedia/wikipedia.html",controller:"WikipediaCtrl"})}]),angular.module("edumaterialApp").factory("Auth",["$location","$rootScope","$http","User","$cookieStore","$q",function a(b,c,d,e,f,g){var h={};return f.get("token")&&(h=e.get()),{login:function(a,b){var c=b||angular.noop,i=g.defer();return d.post("/auth/local",{email:a.email,password:a.password}).success(function(a){return f.put("token",a.token),h=e.get(),i.resolve(a),c()}).error(function(a){return this.logout(),i.reject(a),c(a)}.bind(this)),i.promise},logout:function(){f.remove("token"),"carre"===h.provider&&(window.location.href="https://carre.kmi.open.ac.uk/devices/accounts/logout?next="+b.absUrl()),h={}},createUser:function(a,b){var c=b||angular.noop;return e.save(a,function(b){return f.put("token",b.token),h=e.get(),c(a)},function(a){return this.logout(),c(a)}.bind(this)).$promise},changePassword:function(a,b,c){var d=c||angular.noop;return e.changePassword({id:h._id},{oldPassword:a,newPassword:b},function(a){return d(a)},function(a){return d(a)}).$promise},getCurrentUser:function(){return a.currentUser=h,h},isLoggedIn:function(){return h.hasOwnProperty("role")},isLoggedInAsync:function(a){h.hasOwnProperty("$promise")?h.$promise.then(function(){a(!0)})["catch"](function(){a(!1)}):a(h.hasOwnProperty("role")?!0:!1)},isAdmin:function(){return"admin"===h.role},getToken:function(){return f.get("token")}}}]),angular.module("edumaterialApp").factory("User",["$resource",function(a){return a("/api/users/:id/:controller",{id:"@_id"},{changePassword:{method:"PUT",params:{controller:"password"}},get:{method:"GET",params:{id:"me"}}})}]),angular.module("edumaterialApp").factory("Modal",["$rootScope","$modal",function(a,b){function c(c,d){var e=a.$new();return c=c||{},d=d||"modal-default",angular.extend(e,c),b.open({templateUrl:"components/modal/modal.html",windowClass:d,scope:e})}return{confirm:{"delete":function(a){return a=a||angular.noop,function(){var b,d=Array.prototype.slice.call(arguments),e=d.shift();b=c({modal:{dismissable:!0,title:"Confirm Delete",html:"<p>Are you sure you want to delete <strong>"+e+"</strong> ?</p>",buttons:[{classes:"btn-danger",text:"Delete",click:function(a){b.close(a)}},{classes:"btn-default",text:"Cancel",click:function(a){b.dismiss(a)}}]}},"modal-danger"),b.result.then(function(b){a.apply(b,d)})}}}}}]),angular.module("edumaterialApp").directive("mongooseError",function(){return{restrict:"A",require:"ngModel",link:function(a,b,c,d){b.on("keydown",function(){return d.$setValidity("mongoose",!0)})}}}),angular.module("edumaterialApp").controller("NavbarCtrl",["$scope","$location","Auth","$state","suggest","$rootScope",function(a,b,c,d,e,f){a.menu=[{title:"Home",link:"/"},{title:"MedlinePLUS",link:"/medlineplus",admin:!0},{title:"BioPortal",link:"/bioportal",admin:!0},{title:"DBpedia",link:"/dbpedia",admin:!0},{title:"Wikipedia",link:"/wikipedia",admin:!0}],a.togglesidebar=function(){f.toggle_sidebar=!f.toggle_sidebar},a.isCollapsed=!0,a.isLoggedIn=c.isLoggedIn,a.isAdmin=c.isAdmin,a.getCurrentUser=c.getCurrentUser,a.query=c.searchQuery,c.notifyNavbar=function(){a.query=c.searchQuery},c.isLoggedIn&&c.getCurrentUser().hasOwnProperty("$promise")&&a.getCurrentUser().$promise.then(function(b){switch(a.user=b,"google"===b.provider?a.user.img=b.google.picture:"twitter"===b.provider?a.user.img=b.twitter.profile_image_url:"carre"===b.provider?a.user.img=b.carre.gravatar||"http://gravatar.com/avatar/3bc777082e578f5d41124e1055227d00?d=mm&s=96&r=G":a.user.img="http://gravatar.com/avatar/3bc777082e578f5d41124e1055227d00?d=mm&s=96&r=G",a.user.provider){case"carre":a.carreUser=!0,a.settingsUrl="https://carre.kmi.open.ac.uk/devices";break;case"local":a.settingsUrl="/settings";break;default:a.settingsUrl=""}}),a.logout=function(){c.logout(),b.path("/login")},a.isActive=function(a){return a===b.path()},a.getSuggestions=function(a){return e["for"](a)},a.searchQuery=function(){c.searchQuery=a.query,a.showSearch=!1,d.forceReload()}}]),angular.module("edumaterialApp").filter("propsFilter",function(){return function(a,b){var c=[];return angular.isArray(a)?a.forEach(function(a){for(var d=!1,e=Object.keys(b),f=0;f<e.length;f++){var g=e[f],h=b[g].toLowerCase();if(-1!==a[g].toString().toLowerCase().indexOf(h)){d=!0;break}}d&&c.push(a)}):c=a,c}}),angular.module("edumaterialApp").factory("socket",["socketFactory",function(a){var b=io("",{path:"/socket.io-client"}),c=a({ioSocket:b});return{socket:c,syncUpdates:function(a,b,d){d=d||angular.noop,c.on(a+":save",function(a){var c=_.find(b,{_id:a._id}),e=b.indexOf(c),f="created";c?(b.splice(e,1,a),f="updated"):b.push(a),d(f,a,b)}),c.on(a+":remove",function(a){var c="deleted";_.remove(b,{_id:a._id}),d(c,a,b)})},unsyncUpdates:function(a){c.removeAllListeners(a+":save"),c.removeAllListeners(a+":remove")}}}]),angular.module("edumaterialApp").filter("strip",function(){return function(a){return String(a).replace(/<[^>]+>/gm,"")}}),angular.module("edumaterialApp").run(["$templateCache",function(a){a.put("app/account/login/login.html",'<div class=container><h1>Login</h1><hr><div class=row><!--<div class="col-sm-6">--><!--  <a class="btn btn-block btn-facebook" href="" ng-click="loginOauth(\'facebook\')">--><!--    <i class="fa fa-facebook"></i> Login with Facebook--><!--  </a>--><!--</div>--><!--<div class="col-sm-6">--><!--  <a class="btn btn-block btn-google-plus" href="" ng-click="loginOauth(\'google\')">--><!--    <i class="fa fa-google-plus"></i> Login with Google--><!--  </a>--><!--</div>--><!--<div class="col-sm-6">--><!--  <a class="btn btn-block btn-twitter" href="" ng-click="loginOauth(\'twitter\')">--><!--    <i class="fa fa-twitter"></i> Login with Twitter--><!--  </a>--><!--</div>--><div class="col-sm-4 col-sm-offset-4"><a class="btn btn-block btn-local-login" href="" ng-click="loginOauth(\'carre\')">Login with CARRE</a></div></div></div>'),
a.put("app/account/settings/settings.html",'<div class=container><div class=row><div class=col-sm-12><h1>Change Password</h1></div><div class=col-sm-12><form class=form name=form ng-submit=changePassword(form) novalidate><div class=form-group><label>Current Password</label><input type=password name=password class=form-control ng-model=user.oldPassword mongoose-error><p class=help-block ng-show=form.password.$error.mongoose>{{ errors.other }}</p></div><div class=form-group><label>New Password</label><input type=password name=newPassword class=form-control ng-model=user.newPassword ng-minlength=3 required><p class=help-block ng-show="(form.newPassword.$error.minlength || form.newPassword.$error.required) && (form.newPassword.$dirty || submitted)">Password must be at least 3 characters.</p></div><p class=help-block>{{ message }}</p><button class="btn btn-lg btn-primary" type=submit>Save changes</button></form></div></div></div>'),a.put("app/account/signup/signup.html",'<div class=container><h1>Register</h1><hr><div class=row><div class="col-sm-4 col-sm-offset-4"><a class="btn btn-block btn-local-login" href=https://carre.kmi.open.ac.uk/devices/accounts/register target=_blank>Register with CARRE</a></div></div></div>'),a.put("app/admin/admin.html",'<div class=container><p>The delete user and user index api routes are restricted to users with the \'admin\' role.</p><ul class=list-group><li class=list-group-item ng-repeat="user in users"><strong>{{user.name}}</strong><br><span class=text-muted>{{user.email}}</span> <a ng-click=delete(user) class=trash><span class="glyphicon glyphicon-trash pull-right"></span></a></li></ul></div>'),a.put("app/bioportal/bioportal.html",'<header class=hero-unit id=banner><div class=container><div class=row><form ng-submit=searchTerm()><h2>Bioportal explorer</h2><div class=row><div class=col-md-6><h4>Search terms</h4><div class=input-group style="float: left;margin-bottom:10px"><input ng-disabled=!ontology.selected ng-model=queryTerm placeholder="Type terms" class=form-control> <span class=input-group-btn><button class="btn btn-default" type=submit><span class="glyphicon glyphicon-search"></span></button></span></div></div><div class=col-md-6><h4>Ontologies</h4><ui-select multiple ng-model=ontology.selected theme=bootstrap reset-search-input=true on-select=selectedAcronyms()><ui-select-match placeholder="Select an ontology from the list..">{{$item.acronym}}</ui-select-match><ui-select-choices repeat="ontology in ontologies | propsFilter: {name: $select.search, acronym: $select.search} | limitTo:40"><div ng-bind-html="ontology.name | highlight: $select.search"></div></ui-select-choices></ui-select></div></div></form></div></div></header><div class="container results"><hgroup ng-show="total>0" class=mb20><h1>Search Results : <strong class=text-danger>{{total}}</strong> results were found for the search for <strong class=text-danger>{{queryTerm}}</strong></h1></hgroup><div class="alert alert-warning" ng-hide="total>0">No results yet...</div><section class="col-xs-12 col-sm-6 col-md-12"><!--TOP Pagination--><div class=text-center><pagination ng-show="results.pageCount>1" total-items=total ng-model=results.page ng-change=searchTerm() max-size=5 rotate=false></pagination></div><article class="search-result row" ng-repeat="doc in results.collection"><!--slide down info--><div><!--left column--><div class="col-xs-12 col-sm-12 col-md-9"><h3 ng-bind-html=doc.prefLabel></h3><div ng-bind-html=doc.definition[0]></div></div><!--right column--><div class="col-xs-12 col-sm-12 col-md-3"><h4 ng-show=doc.cui>UMLS : {{doc.cui[0]}}</h4><h4><a target=_blank ng-href="{{ doc[\'@id\'] }}">{{ doc.links.ontology.substr(doc.links.ontology.lastIndexOf(\'/\')+1) }}</a></h4><h4 ng-show="doc.synonym.length>0">Synonyms</h4><ul class=meta-search><li ng-repeat="s in doc.synonym">{{s}}</li></ul></div></div><span class="clearfix borda"></span><hr border=2></article><!--BOTTOM Pagination--><div class=text-center><pagination ng-show="results.pageCount>1" total-items=total ng-model=results.page ng-change=searchTerm() max-size=5 rotate=false></pagination></div></section></div>'),a.put("app/dbpedia/dbpedia.html",'<header class=hero-unit id=banner><div class=container><h2>DBpedia Diseases</h2><div class=row><form ng-submit=searchTerm()><div class="input-group custom-search-form"><input ng-model=queryTerm placeholder="Type terms" class=form-control> <span class=input-group-btn><button class="btn btn-default" type=submit><span class="glyphicon glyphicon-search"></span></button></span></div><!-- /input-group --></form></div></div></header><div class="container results"><hgroup ng-show="total>0" class=mb20><h1>Search Results : <strong class=text-danger>{{total}}</strong> results were found for the search for <strong class=text-danger>{{queryTerm}}</strong></h1></hgroup><div class="alert alert-warning" ng-hide="total>0">No results yet...</div><section class="col-xs-12 col-sm-6 col-md-12"><!--TOP Pagination--><div class=text-center><pagination ng-show="total>itemsPerPage" total-items=total ng-model=currentPage ng-change=searchTerm() max-size=itemsPerPage rotate=true></pagination></div><article class="search-result row" ng-repeat="doc in filteredResults"><!--slide down info--><div><!--left column--><div class="col-xs-12 col-sm-4 col-md-2"><div ng-show=doc.thumbnail class=thumbnail><img ng-src={{doc.thumbnail.value}}></div><div ng-hide=doc.thumbnail class=thumbnail><img src=http://www.solid-run.com/wiki/images/7/75/No_image_available.png></div></div><!--middle column--><div class="col-xs-12 col-sm-8 col-md-7"><h3 ng-bind-html=doc.label.value></h3><div ng-bind-html=doc.abstract.value></div></div><!--right column--><div class="col-xs-12 col-sm-12 col-md-3"><h4>Info</h4><div class=well-sm><li ng-show=doc.icd10.value>ICD-10: {{doc.icd10.value}}</li><li ng-show=doc.meshid.value>MESH: {{doc.meshid.value}}</li><li ng-show=doc.wordnet.value><a target=_blank ng-href={{doc.wordnet.value}}>WordNet</a></li><li ng-show=doc.medlineplus.value><a target=_blank ng-href=http://www.nlm.nih.gov/medlineplus/ency/article/000913{{doc.medlineplus.value}}.htm>MedlinePLUS</a></li><li ng-show=doc.u.value><a target=_blank ng-href={{doc.u.value}}>DBpedia</a></li><li ng-show=doc.wikilink.value><a target=_blank ng-href={{doc.wikilink.value}}>WikiPedia</a></li></div></div></div><span class="clearfix borda"></span><hr border=2></article><!--BOTTOM Pagination--><div class=text-center><pagination ng-show="total>itemsPerPage" total-items=total ng-model=currentPage ng-change=searchTerm() max-size=itemsPerPage rotate=true></pagination></div></section></div>'),a.put("app/main/article_view.html",'<!--ARTICLE PREVIEW--><div class="overlay overlay-door" ng-class="{\'open\':showArticle}"><div class="well preview-container"><div class="clearfix row preview-status"><div class=col-sm-6><button type=button ng-click=toggleArticle(-1) class="overlay overlay-close carre-btn"><span class="glyphicon glyphicon-circle-arrow-left"></span></button></div><div class=col-sm-6><button type=button ng-click="isCollapsed=!isCollapsed" ng-class="{\'active\':isCollapsed}" class="overlay overlay-edit carre-btn"><span class="glyphicon glyphicon-edit"></span></button></div></div><div class="clearfix row rating-container" collapse=!isCollapsed><div class="col-xs-12 col-sm-12 col-md-12"><div class="panel panel-default"><div class=panel-heading><h3 class=panel-title>Extra Information</h3></div><div class=panel-body><h4>Coming soon!</h4></div></div></div><div ng-if=isLoggedIn() class="col-xs-12 col-sm-12 col-md-12"><div class="panel panel-default"><div class=panel-heading><h3 class=panel-title>Article Rating</h3></div><div class=panel-body><div class=row><div class=col-sm-4 ng-repeat="rate in rating track by $index">{{rate.name}} :<rating class=rating ng-model=doc.rating[$index].value max=5></rating></div></div></div></div></div></div></div><div style="position:relative; width:auto; height:auto; margin:auto; top:100px" ng-hide=doc.iframe||!showArticle class=spinner><div class=bounce1></div><div class=bounce2></div><div class=bounce3></div></div><div style=height:100% class="embed-responsive embed-responsive-4by3" ng-bind-html=doc.iframe></div></div>'),a.put("app/main/main.html",'<header class=hero-unit id=banner><div ng-hide=isLoggedIn() class=container><h2>CARRE Educational Resources</h2><p><a style=color:white href=/login>Login</a> to enable rating</p></div><div class=container><form ng-submit=searchQuery()><div class=row><div class="col-sm-8 col-sm-offset-2"><div class="input-group search-panel row"><div class=input-group-btn><select class=form-control style="min-width:140px;z-index: inherit" ng-model=curSource ng-options="opt as opt.label for opt in docSources" ng-change=onComplete()></select></div><input ng-model=queryTerm style="z-index: inherit" placeholder="Carre terms" typeahead="term.name for term in riskElements| filter:$viewValue | limitTo:8" class=form-control typeahead-editable=true typeahead-focus-first=false typeahead-on-select="onComplete($item, $model, $label)"> <span class=input-group-btn><button class="btn btn-default" ng-click=searchQuery() type=submit><span class="glyphicon glyphicon-search"></span></button></span></div></div></div><!--<div class="row">--><!--  <div class="col-sm-8 col-sm-offset-2">--><!--    <h4 ng-show="total>0" class="text-left"><strong class="text-danger">{{total}}</strong> results</h4>--><!--    <div class="text-right"></div>--><!--  </div>--><!--</div>--></form></div></header><!--Wikipedia typeahead--><!--<input style="z-index: inherit;" type="text" ng-model="queryTerm" placeholder="Type terms" typeahead="term for term in getSuggestions($viewValue)" typeahead-loading="loading" class="form-control" typeahead-on-select="onComplete($label)">--><div class="container results"><div><!--top pagination--><div style=padding-left:0 class="col-sm-8 pull-right"><pagination ng-show="total>itemsPerPage" items-per-page=itemsPerPage style="z-index: inherit; float:right; margin:auto" total-items=total ng-model=currentPage ng-change=searchQuery(true) max-size=3 rotate=false></pagination></div><div class="col-sm-4 pull-left"><!--total results--><h3 ng-show="total>0"><strong class=text-danger>{{total}}</strong> results</h3></div></div><!-- Suggestions --><!--<div ng-show="suggestion">--><!--    <h4>Did you mean <a href="" ng-click="suggest(suggestion)">{{suggestion}}</a>?</h4>--><!--    <hr>--><!--</div>--><!-- no results --><div class="alert alert-warning" ng-hide="total>0">No results...</div><section class="col-xs-12 col-sm-6 col-md-12"><div class=list-group><a href="" ng-click=toggleArticle($index) class=list-group-item ng-repeat="doc in results track by $index"><h4 class=list-group-item-heading>{{doc.title|strip}} <span class="label label-info">{{doc.avgRating|number:1 }}</span></h4><p class=list-group-item-text ng-bind-html=doc.snippet></p></a></div></section><!--bottom pagination--><pagination ng-show="total>itemsPerPage" items-per-page=itemsPerPage style="z-index: inherit; float:right; margin:auto" total-items=total ng-model=currentPage ng-change=searchQuery(true) max-size=3 rotate=false></pagination></div><!--ARTICLE PREVIEW--><div class="overlay overlay-door" ng-class="{\'open\':showArticle}"><div class="well preview-container"><div class="clearfix row preview-status"><div class=col-sm-6><button type=button ng-click=toggleArticle(-1) class="overlay overlay-close carre-btn"><span class="glyphicon glyphicon-circle-arrow-left"></span></button></div><div class=col-sm-6><button ng-show=isLoggedIn() type=button ng-click="isCollapsed=!isCollapsed" ng-class="{\'active\':isCollapsed}" class="overlay overlay-edit carre-btn"><span class="glyphicon glyphicon-edit"></span></button></div></div><div class="clearfix row rating-container" collapse=!isCollapsed><div class="col-xs-12 col-sm-12 col-md-12"><!--<div class="panel panel-default">--><!--  <div class="panel-heading">--><!--    <h3 class="panel-title">Extra Information</h3>--><!--  </div>--><!--  <div class="panel-body">--><!--    <h4>Coming soon!</h4>--><!--  </div>--><!--</div>--></div><div class="col-xs-12 col-sm-12 col-md-12"><div class="panel panel-default"><div class=panel-heading><h3 class=panel-title>Article Rating</h3></div><div class=panel-body><div class=row><div class=col-sm-4 ng-repeat="rate in rating track by $index">{{rate.name}} :<rating class=rating ng-model=doc.rating[$index].value max=5></rating></div></div></div></div></div></div></div><div style="position:relative; width:auto; height:auto; margin:auto; top:100px" ng-hide=doc.iframe||!showArticle class=spinner><div class=bounce1></div><div class=bounce2></div><div class=bounce3></div></div><div style=height:100% class="embed-responsive embed-responsive-4by3" ng-bind-html=doc.iframe></div></div>'),a.put("app/medlineplus/medlineplus.html",'<header class=hero-unit id=banner><div class=container><h2>MedlinePLUS API</h2><div class=row><form ng-submit=searchTerm()><div class="input-group custom-search-form"><input ng-model=medlineTerm placeholder="Type terms" class=form-control> <span class=input-group-btn><button class="btn btn-default" type=submit><span class="glyphicon glyphicon-search"></span></button></span></div><!-- /input-group --></form></div></div></header><div class="container results"><hgroup ng-show="totalPagination>0" class=mb20><h1>Search Results : <strong class=text-danger>{{totalPagination}}</strong> results were found for the search for <strong class=text-danger>{{medlineTerm}}</strong></h1></hgroup><div class="alert alert-warning" ng-hide="totalPagination>0">No results yet...</div><section class="col-xs-12 col-sm-6 col-md-12"><!--TOP Pagination--><div class=text-center><pagination ng-show="pageCountPagination>1" items-per-page=maxPerPage total-items=totalPagination ng-model=curPagePagination ng-change=searchTerm() max-size=maxPagination rotate=rotatePagination></pagination></div><article class="search-result row" ng-repeat="doc in results.list"><!--slide down info--><div><!--left column--><div class="col-xs-12 col-sm-12 col-md-9"><h3 ng-bind-html=doc.title></h3><div ng-bind-html=doc.FullSummary></div></div><!--right column--><div class="col-xs-12 col-sm-12 col-md-3"><h4><u>Rating</u></h4><ul class=meta-rating><li>Subject Coverage :<rating class=rating ng-model=coverageRate max=max></rating></li><li>Information quality :<rating class=rating ng-model=qualityRate max=max></rating></li><li>Omissions :<rating class=rating ng-model=omissionsRate max=max></rating></li><li>Controversial :<rating class=rating ng-model=controversialityRate max=max></rating></li></ul><h4><u>Info</u></h4><ul class=meta-info><li><a ng-href={{doc.url}} target=_blank>Read on Medlineplus</a></li><li><b>Organization</b> :<span ng-bind-html=doc.organizationName></span></li><li><b>Alternative title</b>:<span ng-bind-html=doc.altTitle></span></li><li><b>MESH term</b>:<span ng-bind-html=doc.mesh></span></li><li><b>Group</b>:<span ng-bind-html=doc.groupName></span></li></ul></div></div><span class="clearfix borda"></span><hr border=2></article><!--BOTTOM Pagination--><div class=text-center><pagination ng-show="pageCountPagination>1" total-items=totalPagination ng-model=curPagePagination ng-change=searchTerm() max-size=maxPagination rotate=rotatePagination></pagination></div></section></div>'),a.put("app/wikipedia/wikipedia.html",'<header class=hero-unit id=banner><div class=container><h2>Wikipedia Diseases</h2><div class=row><form ng-submit=searchTerm()><div class="input-group custom-search-form"><input style="z-index: inherit" ng-model=queryTerm placeholder="Type terms" typeahead="term for term in getSuggestions($viewValue)" typeahead-loading=loading class=form-control typeahead-on-select=onComplete($label)> <span class=input-group-btn><button class="btn btn-default" type=submit><span class="glyphicon glyphicon-search"></span></button></span></div><!-- /input-group --></form></div></div></header><div class="container results"><hgroup ng-show="total>0" class=mb20><h1>Search Results : <strong class=text-danger>{{total}}</strong> results were found for the search for <strong class=text-danger>{{queryTerm}}</strong></h1></hgroup><!-- Suggestions --><div ng-show=suggestion><h4>Did you mean <a href="" ng-click=suggest(suggestion)>{{suggestion}}</a>?</h4><hr></div><!-- no results --><div class="alert alert-warning" ng-hide="total>0">No results...</div><section class="col-xs-12 col-sm-6 col-md-12"><!--TOP Pagination--><div class=text-center><pagination ng-show="total>itemsPerPage" items-per-page=itemsPerPage style="z-index: inherit" total-items=total ng-model=currentPage ng-change=searchTerm(true) max-size=5 rotate=false></pagination></div><div class=list-group><a href="" ng-click=toggleArticle($index) class=list-group-item ng-repeat="doc in results track by $index"><h4 class=list-group-item-heading ng-bind-html=doc.title></h4><p class=list-group-item-text ng-bind-html=doc.snippet></p></a></div><!--BOTTOM Pagination--><div class=text-center><pagination ng-show="total>itemsPerPage" items-per-page=itemsPerPage total-items=total ng-model=currentPage ng-change=searchTerm(true) max-size=5 rotate=false></pagination></div></section></div><div class="overlay overlay-door" ng-class="{\'open\':showArticle}"><div class="well preview-container"><div class="clearfix row preview-status"><div class=col-sm-3><button type=button ng-click=toggleArticle(-1) class="overlay overlay-close carre-btn"><span class="glyphicon glyphicon-circle-arrow-left"></span></button></div><div class=col-sm-3>You searched for : <span class="label label-primary" ng-bind=queryTerm></span></div><div class=col-sm-3>{{doc.title}}</div><div class=col-sm-3><button type=button ng-click="isCollapsed=!isCollapsed" ng-class="{\'active\':isCollapsed}" class="overlay overlay-edit carre-btn"><span class="glyphicon glyphicon-edit"></span></button></div></div><div class="clearfix row rating-container" collapse=!isCollapsed><div class="col-xs-12 col-sm-12 col-md-4"><div class="panel panel-default"><div class=panel-heading><h3 class=panel-title>Extra Information</h3></div><div class=panel-body><h4>Coming soon!</h4></div></div></div><div class="col-xs-12 col-sm-12 col-md-8"><div class="panel panel-default"><div class=panel-heading><h3 class=panel-title>Article Rating</h3></div><div class=panel-body><div class=row><div class=col-sm-4 ng-repeat="rate in rating track by $index">{{rate.name}} :<rating class=rating ng-model=doc.rating[$index].value max=5></rating></div></div></div></div></div></div></div><!--<div style="height:100%" class="embed-responsive embed-responsive-4by3" ng-bind-html="doc.iframe">--><!--  <div class="spinner">--><!--    <div class="bounce1"></div>--><!--    <div class="bounce2"></div>--><!--    <div class="bounce3"></div>--><!--  </div>--><!--</div>--></div>'),a.put("components/footer/footer.html",'<footer class=footer><div class=container><div style="float:left;margin:0px 10px"><img src=CARRE-FooterLogo.png width=36 height=40 alt=CARRE> <a href="http://cordis.europa.eu/" target=_blank><img alt=Picture1 src=Picture1-150x150.png width=30 height=30></a></div><div style="float:left;margin:0px 10px">CARRE project is partly funded by the EC under the grant no. FP7-ICT-611140</div></div></footer>'),a.put("components/modal/modal.html",'<div class=modal-header><button ng-if=modal.dismissable type=button ng-click=$dismiss() class=close>&times;</button><h4 ng-if=modal.title ng-bind=modal.title class=modal-title></h4></div><div class=modal-body><p ng-if=modal.text ng-bind=modal.text></p><div ng-if=modal.html ng-bind-html=modal.html></div></div><div class=modal-footer><button ng-repeat="button in modal.buttons" ng-class=button.classes ng-click=button.click($event) ng-bind=button.text class=btn></button></div>'),a.put("components/navbar/navbar.html",'<div class="navbar navbar-default navbar-static-top" ng-controller=NavbarCtrl><!--top awesome search bar--><!--    \ntypeahead="term for term in getSuggestions($viewValue)" typeahead-loading="loading" typeahead-on-select="searchQuery()" typeahead-template-url="customTemplate.html"\n--><div class="search-input search-input-unfold" ng-class="{\'open\':showSearch}"><form id=search-form ng-submit=searchQuery() role=search><input tabindex=0 autocomplete=off ng-model=query autocorrect=off id=search-input placeholder=Search...><div ng-click="showSearch=!showSearch" class=close>&times;</div></form></div><!--typical navbar--><div class=container><div class=navbar-header><button class=navbar-toggle type=button ng-click="isCollapsed = !isCollapsed"><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href=# ng-click=togglesidebar() class=navbar-brand><img style=margin-top:-9px src=CARRE-FooterLogo.png width=36 height=40 alt=CARRE></a></div><div collapse=isCollapsed class="navbar-collapse collapse" id=navbar-main><ul class="nav navbar-nav"><li ng-repeat="item in menu" ng-class="{active: isActive(item.link)}"><a ng-hide=(item.admin&&!isAdmin())||(item.user&&!isLoggedIn()) ng-href={{item.link}}>{{item.title}}</a></li><li ng-show=isAdmin() ng-class="{active: isActive(\'/admin\')}"><a href=/admin>Admin</a></li><li ng-show=carreUser><a href=https://carre.kmi.open.ac.uk/devices>CARRE Devices</a></li></ul><ul class="nav navbar-nav navbar-right"><!--search functions--><li ng-show=isLoggedIn()><a class=btn-search ng-click="showSearch=!showSearch" href=""><span class="label label-lg label-default" ng-bind=query></span> <span><i class="glyphicon glyphicon-search"></i></span></a></li><!--User functions--><li ng-show=isLoggedIn() class="dropdown text-normal"><a id=avatar class="dropdown-toggle nav-profile" data-toggle=dropdown><span>{{ user.name }}</span> <img ng-src={{user.img}} class=img-circle></a><ul class="dropdown-menu with-arrow pull-right"><li ng-show=settingsUrl><a ng-href={{settingsUrl}}/accounts/recover><i class="glyphicon glyphicon-lock"></i> <span>Change Password</span></a></li><li ng-show=settingsUrl><a ng-href={{settingsUrl}}/accounts/settings><i class="glyphicon glyphicon-cog"></i> <span>Settings</span></a></li><li><a href="" ng-click=logout()><i class="glyphicon glyphicon-log-out"></i> <span>Log Out</span></a></li></ul></li><li ng-hide=isLoggedIn() ng-class="{active: isActive(\'/signup\')}"><a href=/signup>Sign up</a></li><li ng-hide=isLoggedIn() ng-class="{active: isActive(\'/login\')}"><a href=/login>Login</a></li></ul></div></div></div><script type=text/ng-template id=customTemplate.html><a><span bind-html-unsafe="match.label | typeaheadHighlight:query"></span></a></script>')}]);